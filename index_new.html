<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LeetCode-style Challenges</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,sans-serif}
body{min-height:100vh;background:#1e1e1e;color:#fff}
.navbar{display:flex;align-items:center;justify-content:space-between;background:#282828;padding:0 20px;height:50px;border-bottom:1px solid #404040;position:fixed;top:0;left:0;right:0;z-index:1000}
.navbar-brand{display:flex;align-items:center;gap:8px;color:#a5d8ff;font-weight:600;font-size:18px;margin-left:32px}
.nav-right{display:flex;align-items:center;gap:16px}
.user-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#666;color:#fff;font-weight:600}
.main-container{display:flex;margin-top:50px;height:calc(100vh - 50px)}
.user-login-bar{display:flex;align-items:center;gap:10px;background:#282828;padding:10px 20px;border-bottom:1px solid #404040}
.user-login-bar button{padding:5px 10px;border-radius:4px;border:none;background:#a5d8ff;color:#1e1e1e;cursor:pointer}
.user-login-bar button:hover{background:#90cfff}
#main-content{flex:1;padding:20px}
#game-board{margin-top:20px;display:grid;gap:10px;max-width:420px}
.player-row{display:flex;align-items:center;gap:10px;background:#282828;border:1px solid #404040;border-radius:8px;padding:10px}
.player-label{color:#bbb;width:80px}
.player-name{padding:4px 8px;border-radius:6px;background:#1e1e1e;border:1px solid #333;min-width:120px;display:inline-flex;align-items:center;gap:6px}
.player-name[contenteditable="true"]{outline:none;border-color:#a5d8ff;box-shadow:0 0 0 2px rgba(165,216,255,.15)}
.rename-btn{background:none;border:none;color:#a5d8ff;cursor:pointer;display:inline-flex;align-items:center}
.rename-btn:hover{color:#90cfff}
</style>
</head>
<body>

<nav class="navbar">
  <div class="navbar-brand">
    <span class="material-icons">code</span>
    Code Challenges
  </div>
  <div class="nav-right" id="navbar-user-info"></div>
</nav>

<div class="user-login-bar" style="margin-top:50px;">
  <label>Users:</label>
  <div id="user-list-bar" style="display:flex;gap:8px;"></div>
  <button id="add-user-btn">Add User</button>
</div>

<div class="main-container">
  <div id="main-content">
    <h1>Welcome to Coding Challenges</h1>
    <p>Edit player names directly below or add new users.</p>

    <div id="game-board">
      <div class="player-row">
        <div class="player-label">Player 1</div>
        <div class="player-name" id="player1-name" contenteditable="false"></div>
        <button class="rename-btn" onclick="startInlineRename(0)">
          <span class="material-icons">edit</span>
        </button>
      </div>
      <div class="player-row">
        <div class="player-label">Player 2</div>
        <div class="player-name" id="player2-name" contenteditable="false"></div>
        <button class="rename-btn" onclick="startInlineRename(1)">
          <span class="material-icons">edit</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// ---------------- LocalStorage helpers ----------------
const USER_LIST_KEY = 'challengeUserList';
const CURRENT_USER_KEY = 'challengeCurrentUser';
const DISPLAY_NAMES_KEY = 'challengeUserDisplayNames';

function getUserList() {
  const raw = localStorage.getItem(USER_LIST_KEY);
  if (raw) return JSON.parse(raw);
  const defaults = ["Player1", "Player2"];
  localStorage.setItem(USER_LIST_KEY, JSON.stringify(defaults));
  return defaults;
}
function saveUserList(list) {
  localStorage.setItem(USER_LIST_KEY, JSON.stringify(list));
}
function getDisplayNames() {
  return JSON.parse(localStorage.getItem(DISPLAY_NAMES_KEY) || '{}');
}
function saveDisplayNames(obj) {
  localStorage.setItem(DISPLAY_NAMES_KEY, JSON.stringify(obj));
}
function getDisplayName(user) {
  const names = getDisplayNames();
  return names[user] || user;
}
function setDisplayName(user, name) {
  const names = getDisplayNames();
  names[user] = name;
  saveDisplayNames(names);
}

// ---------------- Renderers ----------------
function renderNavbarUser() {
  const nav = document.getElementById('navbar-user-info');
  nav.innerHTML = '';
  const users = getUserList();
  users.forEach(u => {
    const avatar = document.createElement('div');
    avatar.className = 'user-avatar';
    avatar.textContent = (getDisplayName(u)[0] || '?').toUpperCase();
    nav.appendChild(avatar);
    const name = document.createElement('span');
    name.textContent = getDisplayName(u);
    name.style.marginRight = '16px';
    nav.appendChild(name);
  });
}

function renderUserListBar() {
  const bar = document.getElementById('user-list-bar');
  bar.innerHTML = '';
  getUserList().forEach(u => {
    const btn = document.createElement('button');
    btn.textContent = getDisplayName(u);
    btn.onclick = () => alert(`Current user: ${getDisplayName(u)}`);
    btn.ondblclick = () => {
      const newName = prompt('Enter new name:', getDisplayName(u));
      if (!newName) return;
      setDisplayName(u, newName.trim());
      renderAll();
    };
    bar.appendChild(btn);
  });
}

function renderPlayers() {
  const users = getUserList();
  document.getElementById('player1-name').textContent = getDisplayName(users[0]);
  document.getElementById('player2-name').textContent = getDisplayName(users[1]);
}

// ---------------- Inline rename on board ----------------
function startInlineRename(index) {
  const users = getUserList();
  const userId = users[index];
  const span = document.getElementById(index === 0 ? 'player1-name' : 'player2-name');

  span.setAttribute('contenteditable', 'true');
  span.focus();

  const finish = (save) => {
    span.removeAttribute('contenteditable');
    if (save) {
      const newName = span.textContent.trim();
      if (newName && newName !== getDisplayName(userId)) {
        setDisplayName(userId, newName);
      } else {
        span.textContent = getDisplayName(userId);
      }
    } else {
      span.textContent = getDisplayName(userId);
    }
    renderAll();
  };

  const keyHandler = (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      finish(true);
    } else if (e.key === 'Escape') {
      e.preventDefault();
      finish(false);
    }
  };
  span.addEventListener('keydown', keyHandler);
  span.addEventListener('blur', () => finish(true), { once: true });
}

// ---------------- Add user ----------------
document.getElementById('add-user-btn').addEventListener('click', () => {
  const name = prompt('Enter new user name:');
  if (!name) return;
  const list = getUserList();
  if (!list.includes(name)) list.push(name);
  saveUserList(list);
  setDisplayName(name, name);
  renderAll();
});

// ---------------- Render all ----------------
function renderAll() {
  renderNavbarUser();
  renderUserListBar();
  renderPlayers();
}

// ---------------- Init ----------------
document.addEventListener('DOMContentLoaded', () => {
  const users = getUserList();
  const names = getDisplayNames();
  users.forEach(u => { if (!names[u]) names[u] = u; });
  saveDisplayNames(names);
  renderAll();
});
</script>

</body>
</html>
