<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Our Coding Challenges</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,sans-serif}
    body{min-height:100vh;background:#1e1e1e;color:#fff}

    /* Navbar (fixed) */
    .navbar{display:flex;align-items:center;justify-content:space-between;background:#282828;padding:0 16px;height:56px;border-bottom:1px solid #404040;position:fixed;top:0;left:0;right:0;z-index:1000}
    .navbar-brand{display:flex;align-items:center;gap:8px;color:#a5d8ff;font-weight:600;cursor:pointer}
    .navbar-brand:hover{color:#74c0fc}
    .nav-right{display:flex;align-items:center;gap:16px}
    .navbar {
      justify-content: space-between;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #a5d8ff;
      font-weight: 600;
      font-size: 20px;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .navbar-brand:hover {
      color: #74c0fc;
    }

    .user-profiles {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-right: 8px;
    }

    .navbar .material-icons {
      vertical-align: middle;
    }
    .navbar-brand:hover .material-icons {
      animation: pulse 0.8s infinite alternate;
    }

    @keyframes pulse {
      from { transform: scale(1); color: #a5d8ff; }
      to { transform: scale(1.2); color: #ff99c8; }
    }
    /* Animated heart between players */
    .middle-heart {
      color: #ff99c8;
      opacity: 0.8;
      transition: transform 0.3s ease, opacity 0.3s ease;
      cursor: pointer;
    }

    .middle-heart:hover {
      animation: heartPulse 1.2s infinite ease-in-out;
    }

    @keyframes heartPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.3);
        opacity: 1;
      }
    }


    /* Player chips */
    .user-profiles{display:flex;align-items:center;gap:12px}
    .user-profile{display:flex;align-items:center;gap:8px;background:#333;border:1px solid #3c3c3c;padding:6px 10px;border-radius:999px}
    .user-avatar{width:28px;height:28px;border-radius:50%;background:#a5d8ff;color:#111;display:flex;align-items:center;justify-content:center;font-weight:700}
    .user-info{display:flex;align-items:center;gap:6px}
    .user-name{padding:2px 6px;border-radius:6px;background:#1e1e1e;border:1px solid #333;min-width:90px;outline:none}
    .user-name[contenteditable="true"]{border-color:#a5d8ff;box-shadow:0 0 0 2px rgba(165,216,255,.15)}
    .edit-icon{font-size:18px;opacity:.8;cursor:pointer}
    .edit-icon:hover{opacity:1}

    /* Scoreboard bar (scrolls with page) */
    .scorebar{background:#282828;border-bottom:1px solid #404040;padding:8px 16px;margin-top:56px;display:flex;align-items:center;justify-content:space-between}
    .scorebar .left{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .scorebar .reset-btn{background:#3a3a3a;border:1px solid #4a4a4a;color:#ddd;padding:6px 10px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:6px}
    .scorebar .reset-btn:hover{background:#444}

    /* Layout */
    .main-container{display:flex;height:calc(100vh - 56px - 48px)} /* minus navbar & approx scorebar height */
    #sidebar{width:270px;background:#282828;border-right:1px solid #404040;padding:16px;overflow-y:auto;transition:transform .3s ease}
    #main-content{flex:1;padding:20px;overflow-y:auto}

    /* Sidebar: accordion */
    #sidebar h3{color:#60a5fa;margin-bottom:12px;display:flex;align-items:center;gap:8px}
    .section-accordion{margin-bottom:10px;border:1px solid #3a3a3a;border-radius:8px;overflow:hidden}
    .section-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#333;cursor:pointer}
    .section-header:hover{background:#3a3a3a}
    .section-header .title{display:flex;align-items:center;gap:8px;font-weight:600}
    .section-content{max-height:0;overflow:hidden;transition:max-height .28s ease}
    .section-accordion.active .section-content{max-height:600px}
    .section-content ul{list-style:none}
    .section-content li{display:flex;align-items:center;gap:8px;padding:10px 14px;cursor:pointer}
    .section-content li:hover{background:#333}
    .section-content li.active{background:#404040;color:#a5d8ff}
    .section-content li.completed::after{content:"✓";margin-left:auto;color:#2e7d32}

    /* Mobile sidebar toggle */
    .sidebar-toggle{display:none;position:fixed;left:12px;top:64px;z-index:1100;background:#a5d8ff;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.25)}
    .sidebar-toggle .material-icons{color:#111}
    @media (max-width: 900px){
      #sidebar{position:fixed;left:0;top:104px;bottom:4px;transform:translateX(-100%);z-index:1050}
      #sidebar.active{transform:translateX(0)}
      .sidebar-toggle{display:flex;align-items:center;justify-content:center}
      #progress-container{left:0!important}
      .workspace{grid-template-columns:1fr!important}
      .versus-grid{grid-template-columns:1fr!important}
    }

    /* Home */
    .welcome-banner{text-align:center;padding:40px;background:linear-gradient(45deg,#282828,#333);border:1px solid #3a3a3a;border-radius:12px;margin-bottom:24px}
    .welcome-banner h1{color:#60a5fa;margin-bottom:8px}
    .section{margin-bottom:36px}
    .section h2{color:#60a5fa;margin-bottom:14px;border-bottom:1px solid #404040;padding-bottom:6px}
    .challenge-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .challenge-card{background:#282828;border:1px solid #404040;border-radius:10px;padding:16px;cursor:pointer;transition:.18s;position:relative}
    .challenge-card:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.35)}
    .challenge-card h3{margin-bottom:6px}
    .card-description{font-size:14px;color:#bbb}
    .difficulty{position:absolute;top:10px;right:10px;padding:2px 8px;border-radius:12px;font-size:12px;font-weight:700}
    .easy{background:#2e7d32;color:#a5d6a7}.medium{background:#ef6c00;color:#ffcc80}.hard{background:#b71c1c;color:#ef9a9a}

    /* Challenge page */
    .problem-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #404040;padding-bottom:10px;margin-bottom:16px}
    .header-actions{display:flex;align-items:center;gap:10px}
    .completed-badge{background:#2e7d32;color:#fff;padding:4px 8px;border-radius:6px;display:inline-flex;gap:6px;align-items:center}
    .mode-bar{display:flex;gap:10px;margin:10px 0}
    .mode-button{padding:8px 14px;border-radius:20px;border:1px solid #404040;background:#282828;color:#bbb;cursor:pointer}
    .mode-button.active{background:#60a5fa;color:#111;border-color:#60a5fa}

    .tabs{display:flex;gap:18px;border-bottom:1px solid #404040;margin-bottom:12px}
    .tab{background:none;border:none;color:#bbb;cursor:pointer;padding:10px 2px;font-size:15px}
    .tab.active{color:#60a5fa;border-bottom:2px solid #60a5fa}

    .workspace{display:grid;grid-template-columns:1fr 1.1fr;gap:16px}
    .panel{background:#282828;border:1px solid #3a3a3a;border-radius:10px;padding:14px;min-height:220px}
    .language-selector{display:flex;align-items:center;gap:10px;margin:10px 0;padding:8px;background:#1f1f1f;border:1px solid #333;border-radius:8px}
    .language-select{background:#1e1e1e;color:#fff;border:1px solid #404040;padding:6px 10px;border-radius:6px}
    .example-section{background:#1f1f1f;border:1px solid #333;border-radius:8px;padding:12px;margin:12px 0}
    pre{background:#111;padding:12px;border-radius:6px;color:#ccc;overflow:auto}

    textarea{width:100%;min-height:220px;background:#282828;color:#fff;border:1px solid #404040;border-radius:8px;padding:12px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;resize:vertical}
    .button-row{display:flex;gap:10px;margin-top:10px;align-items:center}
    .run-button{background:transparent;color:#a5d8ff;border:1px solid #a5d8ff;padding:8px 14px;border-radius:8px;font-weight:600;cursor:pointer}
    .submit-button{background:#a5d8ff;color:#111;border:none;padding:8px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    .autosave-indicator{font-size:12px;color:#9a9a9a;margin-left:auto}
    .note{font-size:12px;color:#bbb}
    #run-output{margin-top:12px;padding:12px;background:#151515;border:1px solid #383838;border-radius:8px;min-height:64px;color:#d7d7d7;white-space:pre-wrap}

    /* Versus editors side-by-side */
    .versus-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .mini-label{display:flex;align-items:center;gap:8px;margin-bottom:8px;color:#bbb;font-weight:600}

    /* Progress bar */
    #progress-container{position:fixed;bottom:0;left:270px;right:0;height:4px;background:#282828}
    #progress-bar{height:100%;background:#60a5fa;width:0;transition:width .3s ease}
    /* === Celebration Popup === */
#celebration-overlay {
  position: fixed;
  inset: 0;
  display: none;             /* toggled by JS */
  align-items: center;
  justify-content: center;
  z-index: 9999;
  pointer-events: none;       /* let clicks pass through */
}

.celebration-popup {
  min-width: 280px;
  max-width: 90vw;
  padding: 18px 22px;
  text-align: center;
  color: #fff;
  font-weight: 700;
      font-size: 20px;
  border-radius: 16px;
  background: radial-gradient(120px 80px at 30% 20%, rgba(255,182,193,.28), transparent),
              radial-gradient(140px 100px at 70% 60%, rgba(255,105,180,.22), transparent),
              linear-gradient(135deg, #ff7cc8, #ff48a6);
  box-shadow:
    0 10px 30px rgba(255, 105, 180, .35),
    0 0 18px rgba(255, 192, 203, .35) inset,
    0 0 32px rgba(255, 105, 180, .25);
  transform: scale(.9);
  opacity: 0;
  animation: popFade 0.35s ease-out forwards, popOut 3s ease forwards;
  position: relative;
  overflow: hidden;
}

/* floating hearts */
.celebration-popup .hearts {
  position: absolute;
  left: 0; right: 0; bottom: -8px;
  display: flex; gap: 16px; justify-content: center;
  opacity: .9;
}
.celebration-popup .hearts span {
  filter: drop-shadow(0 2px 4px rgba(0,0,0,.2));
  animation: floatUp 2.2s ease-in infinite;
  font-size: 18px;
}
.celebration-popup .hearts span:nth-child(2) { animation-delay: .25s; }
.celebration-popup .hearts span:nth-child(3) { animation-delay: .5s; }
.celebration-popup .hearts span:nth-child(4) { animation-delay: .75s; }
.celebration-popup .hearts span:nth-child(5) { animation-delay: 1s; }

/* sparkles */
.celebration-popup::before, .celebration-popup::after {
  content: "✨✨✨";
  position: absolute;
  top: 8px;
  left: 12px;
  font-size: 12px;
  opacity: .8;
  animation: twinkle 1.6s ease-in-out infinite alternate;
}
.celebration-popup::after {
  top: auto; bottom: 8px; left: auto; right: 12px;
  animation-delay: .4s;
}

/* animations */
@keyframes popFade {
  from { transform: scale(.9); opacity: 0; }
  to   { transform: scale(1);  opacity: 1; }
}
@keyframes popOut {
  0%, 80% { transform: scale(1); opacity: 1; }
  100%    { transform: scale(.98); opacity: 0; }
}
@keyframes floatUp {
  0%   { transform: translateY(0) scale(1);    opacity: .95; }
  70%  { transform: translateY(-48px) scale(1.1); opacity: 1; }
  100% { transform: translateY(-70px) scale(1.15); opacity: 0; }
}
@keyframes twinkle {
  from { opacity: .55; text-shadow: 0 0 6px rgba(255,255,255,.25); }
  to   { opacity: .95; text-shadow: 0 0 12px rgba(255,255,255,.55); }
}


/* ===== Infinite Collage Loop ===== */
.carousel-header {
  text-align: center;
  font-size: 32px;
  font-weight: 700;
  color: #ffb6c1;
  margin: 20px 0;
  text-shadow: 0 0 12px rgba(255,153,200,0.35);
  animation: fadeIn 1.8s ease;
  letter-spacing: 1px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.infinite-collage {
  overflow: hidden;
  width: 100%;
  max-width: 100vw;
  margin: 0 auto 40px;
  border-radius: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.5);
  background: #1e1e1e;
  cursor: grab;
  user-select: none;
  touch-action: pan-y;
}

.scroll-strip {
  display: flex;
  flex-wrap: nowrap;
  gap: 6px;
  width: max-content;
  will-change: transform;          /* add */
  backface-visibility: hidden;     /* add */
}

.scroll-strip img {
  height: 220px;
  width: auto;
  object-fit: cover;
  border-radius: 10px;
  flex-shrink: 0;
  transition: transform 0.3s ease, filter 0.3s ease, opacity 0.4s ease;
  opacity: 0.25;
  filter: brightness(0.78) saturate(0.9);
  background: #252525;
}

.scroll-strip img[data-loaded="true"] {
  opacity: 1;
  filter: none;
}

.scroll-strip img[data-loaded="true"]:hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}

.infinite-collage.active {
  cursor: grabbing;
}

.start-button{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  margin:28px auto 0;
  padding:0;
  font-size:14px;
  font-weight:600;
  letter-spacing:.08em;
  text-transform:none;
  background:none;
  color:#b5dbff;
  border:none;
  border-radius:0;
  box-shadow:none;
  transition:color .16s ease, transform .16s ease;
}
.start-button:hover{
  color:#e3f2ff;
  transform:translateY(-1px);
}

/* Continuous scrolling */
@keyframes scrollLoop {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

/* Optional: pause on hover */
.infinite-collage:hover .scroll-strip {
  animation-play-state: paused;
}

.infinite-collage.active .scroll-strip {
  animation-play-state: paused;
  cursor: grabbing;
}
.infinite-collage:hover .scroll-strip {
  transition: none;
}

  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="navbar-brand" onclick="showHomePage()">
      <span class="material-icons">favorite</span>
      <span>Our Space 💻❤️</span>
    </div>

    <div class="user-profiles">
      <div class="user-profile">
        <div class="user-avatar" id="p1-avatar">P1</div>
        <div class="user-info">
          <div class="user-name" id="p1-name" contenteditable="false"></div>
          <span class="material-icons edit-icon" onclick="enableRename('p1')">edit</span>
        </div>
      </div>
      <span class="material-icons middle-heart">favorite</span>
      <div class="user-profile">
        <div class="user-avatar" id="p2-avatar">P2</div>
        <div class="user-info">
          <div class="user-name" id="p2-name" contenteditable="false"></div>
          <span class="material-icons edit-icon" onclick="enableRename('p2')">edit</span>
        </div>
      </div>
    </div>
  </nav>

  <!-- SCOREBOARD BAR (scrolls with page) -->
  <div class="scorebar">
    <div class="left">
      <span>🏅</span>
      <span id="sb-p1-name">Player 1</span>: <strong id="sb-p1-score">0</strong> pts
      <span style="opacity:.6">|</span>
      <span id="sb-p2-name">Player 2</span>: <strong id="sb-p2-score">0</strong> pts
    </div>
    <button class="reset-btn" id="reset-scores-btn" title="Reset scores">
      <span class="material-icons" style="font-size:18px">restart_alt</span>
      Reset
    </button>
    <button class="reset-btn" id="reset-all-btn" title="Reset all progress, code, and notes">
      <span class="material-icons" style="font-size:18px">delete_sweep</span>
      Full Reset
    </button>
  </div>

  <!-- Mobile toggle -->
  <button class="sidebar-toggle" onclick="document.getElementById('sidebar').classList.toggle('active')">
    <span class="material-icons">menu</span>
  </button>

  <!-- MAIN -->
  <div class="main-container">
    <!-- SIDEBAR -->
    <aside id="sidebar">
      <h3><span class="material-icons">code</span> Challenges</h3>
      <div id="sections-list"></div>
    </aside>

    <!-- CONTENT -->
    <main id="main-content">
      <!-- HOME PAGE -->
      <div id="home-page">
        <div class="welcome-banner">
          <h1>Hi love 💕</h1>
          <p>This is our little space — where we code, laugh, and make memories together.</p>
          <p>You make even debugging fun. I love you. 💻❤️</p>
        </div>

        <h2 class="carousel-header"> Our First Year 💗 </h2>

        <div class="infinite-collage">
          <div class="scroll-strip">
            <!-- Add your 73 photos below -->
            <img src="images/web_optimized/photo.jpg" alt="Us 0" loading="eager" fetchpriority="high" decoding="async" data-loaded="false">
            <img src="images/web_optimized/photo0.jpg" alt="Us 1" loading="eager" fetchpriority="high" decoding="async" data-loaded="false">
            <img src="images/web_optimized/photo1.jpg" alt="Us 2" loading="eager" fetchpriority="high" decoding="async" data-loaded="false">
            <img src="images/web_optimized/photo2.jpg" alt="Us 3" loading="eager" fetchpriority="high" decoding="async" data-loaded="false">
            <img src="images/web_optimized/photo3.jpg" alt="Us 4" loading="eager" fetchpriority="high" decoding="async" data-loaded="false">
            <img src="images/web_optimized/photo4.jpg" alt="Us 5" loading="eager" fetchpriority="high" decoding="async" data-loaded="false">
            <img src="images/web_optimized/photo5.jpg" alt="Us 6" loading="eager" fetchpriority="high" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo6.jpg" alt="Us 7" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo7.jpg" alt="Us 8" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo8.jpg" alt="Us 9" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo9.jpg" alt="Us 10" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo10.jpg" alt="Us 11" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo11.jpg" alt="Us 12" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo12.jpg" alt="Us 13" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo13.jpg" alt="Us 14" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo14.jpg" alt="Us 15" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo15.jpg" alt="Us 16" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo16.jpg" alt="Us 17" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo17.jpg" alt="Us 18" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo18.jpg" alt="Us 19" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo19.jpg" alt="Us 20" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo20.jpg" alt="Us 21" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo21.jpg" alt="Us 22" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo22.jpg" alt="Us 23" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo23.jpg" alt="Us 24" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo24.jpg" alt="Us 25" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo25.jpg" alt="Us 26" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo26.jpg" alt="Us 27" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo27.jpg" alt="Us 28" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo28.jpg" alt="Us 29" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo29.jpg" alt="Us 30" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo30.jpg" alt="Us 31" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo31.jpg" alt="Us 32" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo32.jpg" alt="Us 33" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo33.jpg" alt="Us 34" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo34.jpg" alt="Us 35" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo35.jpg" alt="Us 36" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo36.jpg" alt="Us 37" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo37.jpg" alt="Us 38" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo38.jpg" alt="Us 39" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo39.jpg" alt="Us 40" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo40.jpg" alt="Us 41" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo41.jpg" alt="Us 42" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo42.jpg" alt="Us 43" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo43.jpg" alt="Us 44" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo44.jpg" alt="Us 45" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo45.jpg" alt="Us 46" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo46.jpg" alt="Us 47" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo47.jpg" alt="Us 48" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo48.jpg" alt="Us 49" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo49.jpg" alt="Us 50" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo50.jpg" alt="Us 51" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo51.jpg" alt="Us 52" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo52.jpg" alt="Us 53" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo53.jpg" alt="Us 54" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo54.jpg" alt="Us 55" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo55.jpg" alt="Us 56" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo56.jpg" alt="Us 57" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo57.jpg" alt="Us 58" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo58.jpg" alt="Us 59" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo59.jpg" alt="Us 60" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo60.jpg" alt="Us 61" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo61.jpg" alt="Us 62" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo62.jpg" alt="Us 63" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo63.jpg" alt="Us 64" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo64.jpg" alt="Us 65" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo65.jpg" alt="Us 66" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo66.jpg" alt="Us 67" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo67.jpg" alt="Us 68" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo68.jpg" alt="Us 69" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo69.jpg" alt="Us 70" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo70.jpg" alt="Us 71" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
            <img src="data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="images/web_optimized/photo71.jpg" alt="Us 72" loading="lazy" fetchpriority="low" decoding="async" data-loaded="false">
          </div>

        </div>

        <button class="start-button" onclick="showChallengesPage()">Start Challenges →</button>
      </div>

      <!-- CHALLENGES PAGE -->
      <div id="challenges-page" style="display:none;">
        <div class="welcome-banner">
          <h1>Our Coding Challenges ⚡</h1>
          <p>Where logic meets love 💖</p>
        </div>
        <div id="sections"></div>
      </div>

      <div id="challenge-panel" style="display:none;"></div>
    </main>
  </div>

  <div id="progress-container"><div id="progress-bar"></div></div>

  <script>
    /* ========= Keys ========= */
    const PLAYER_KEY   = 'player_names';
    const PROGRESS_KEY = 'challenge_progress';
    const CODE_KEY     = 'challenge_code_v2';   // id -> lang -> slot -> code
    const NOTES_KEY    = 'challenge_notes';
    const SCORES_KEY   = 'scores_v1';          // {p1:0,p2:0}
    const SCORELOG_KEY = 'score_log_v1';       // id -> 'p1'|'p2'|'both'|'solo'

    /* ========= Data ========= */
    const sectionIcons = { Football:'sports_soccer', Relationship:'favorite', Games:'sports_esports' };

    const challenges = [
      { id:'match-day', category:'Football', difficulty:'Easy',   title:'Match Day Simulator',
        description:'Generate a random football match result for You vs. Him.',
        example:'Output:\nTeam Him 3 - 2 Team You\nCommentary: last-minute goal! ⚽', languages:['python','c'] },
      { id:'penalty-shooter', category:'Football', difficulty:'Medium', title:'Penalty Shootout',
        description:'Simulate a 5-shot penalty shootout — highest goals wins.',
        example:'You: ⚽⚽❌⚽⚽\nHim: ⚽❌⚽⚽❌\nYou win 4–3 🏆', languages:['python','c'] },
      { id:'love-encoder', category:'Relationship', difficulty:'Easy', title:'Love Message Encoder',
        description:'Encode a secret message only you two can read.',
        example:'Input: I love you\nOutput: ❤️🌹#you#love#I', languages:['python','c'] },
      { id:'anniversary-planner', category:'Relationship', difficulty:'Medium', title:'Anniversary Date Planner',
        description:'Generate a random date plan from your favorites.',
        example:'Output: 🎥 Movie night + 🍝 Italian dinner', languages:['python','c'] },
      { id:'game-night', category:'Games', difficulty:'Medium', title:'Game Night Score Tracker',
        description:'Track scores and announce the winner.',
        example:'You 5 — Him 7 → Him wins! 🎉', languages:['python','c'] },
      { id:'guess-the-song', category:'Games', difficulty:'Hard', title:'Guess The Song',
        description:'Play little snippets & guess titles — code the logic.',
        example:'Input: 🎶 "da da da daaaa"\nOutput: "Star Wars Theme!"', languages:['python','c'] }
    ];

    const templates = {
      python: `# Write your Python solution here
# Define a function named solution(), the runner will call it.
def solution():
    print("Hello from solution()")
`,
      c: `// Write your C solution here (won't run in-browser)
// You can still write and save your code.
// Example skeleton:
#include <stdio.h>

int main(){
    // your code
    return 0;
}
`
    };

    /* ========= Player Names ========= */
    function getNames(){ return JSON.parse(localStorage.getItem(PLAYER_KEY) || '{"p1":"Player 1","p2":"Player 2"}'); }
    function saveNames(n){ localStorage.setItem(PLAYER_KEY, JSON.stringify(n)); }
    function updateNamesUI(){
      const n=getNames();
      const p1 = document.getElementById('p1-name');
      const p2 = document.getElementById('p2-name');
      const a1 = document.getElementById('p1-avatar');
      const a2 = document.getElementById('p2-avatar');
      const sb1 = document.getElementById('sb-p1-name');
      const sb2 = document.getElementById('sb-p2-name');
      p1.textContent = n.p1; p2.textContent = n.p2;
      a1.textContent = (n.p1?.[0]||'P').toUpperCase();
      a2.textContent = (n.p2?.[0]||'P').toUpperCase();
      sb1.textContent = n.p1;
      sb2.textContent = n.p2;
    }
    function enableRename(id){
      const el = id==='p1' ? document.getElementById('p1-name') : document.getElementById('p2-name');
      el.setAttribute('contenteditable','true');
      el.focus();
      const finish = (save)=>{
        el.removeAttribute('contenteditable');
        if(save){
          const val = el.textContent.trim();
          const names = getNames();
          if(val) { names[id]=val; saveNames(names); }
        }
        updateNamesUI();
      };
      el.onkeydown = (e)=>{ if(e.key==='Enter'){ e.preventDefault(); finish(true);} if(e.key==='Escape'){ e.preventDefault(); finish(false);} };
      el.onblur = ()=>finish(true);
    }

    /* ========= Sidebar & Home ========= */
    function setupSidebar(){
      const container = document.getElementById('sections-list');
      const cats = [...new Set(challenges.map(c=>c.category))];
      const progress = JSON.parse(localStorage.getItem(PROGRESS_KEY)||'{}');
      container.innerHTML = '';

      cats.forEach(cat=>{
        const sec = document.createElement('div');
        sec.className='section-accordion';
        const items = challenges.filter(c=>c.category===cat);

        sec.innerHTML = `
          <div class="section-header">
            <div class="title">
              <span class="material-icons">${sectionIcons[cat]||'folder_open'}</span>
              ${cat}
            </div>
            <span class="material-icons">expand_more</span>
          </div>
          <div class="section-content">
            <ul>
              ${items.map(c=>`
                <li data-id="${c.id}" class="${progress[c.id]?.completed?'completed':''}">
                  <span class="material-icons">
                    ${c.difficulty==='Easy'?'assignment':(c.difficulty==='Medium'?'assignment_late':'assignment_turned_in')}
                  </span>
                  ${c.title}
                </li>`).join('')}
            </ul>
          </div>
        `;

        sec.querySelector('.section-header').onclick = ()=> sec.classList.toggle('active');
        sec.querySelectorAll('li').forEach(li=>{
          li.onclick = (e)=>{ e.stopPropagation(); location.hash = li.dataset.id; };
        });
        container.appendChild(sec);
      });
    }

    function buildHome(){
      const wrap = document.getElementById('sections');
      wrap.innerHTML='';
      const cats=[...new Set(challenges.map(c=>c.category))];
      cats.forEach(cat=>{
        const section=document.createElement('div');
        section.className='section';
        section.innerHTML = `
          <h2>${cat}</h2>
          <div class="challenge-grid">
            ${challenges.filter(c=>c.category===cat).map(ch=>`
              <div class="challenge-card" onclick="location.hash='${ch.id}'">
                <h3>${ch.title}</h3>
                <p class="card-description">${ch.description}</p>
                <span class="difficulty ${ch.difficulty.toLowerCase()}">${ch.difficulty}</span>
              </div>`).join('')}
          </div>
        `;
        wrap.appendChild(section);
      });
    }

    function highlightActive(hash){
      document.querySelectorAll('#sections-list li').forEach(li=>{
        li.classList.toggle('active', li.dataset.id===hash);
      });
      if(hash){
        const li=document.querySelector(`#sections-list li[data-id="${hash}"]`);
        if(li){ li.closest('.section-accordion')?.classList.add('active'); }
      }
    }

    /* ========= Progress ========= */
    function updateProgress(){
      const p=JSON.parse(localStorage.getItem(PROGRESS_KEY)||'{}');
      const done = Object.values(p).filter(v=>v.completed).length;
      const pct = (done / challenges.length) * 100;
      document.getElementById('progress-bar').style.width = pct + '%';

      document.querySelectorAll('#sections-list li').forEach(li=>{
        li.classList.toggle('completed', !!p[li.dataset.id]?.completed);
      });
    }

    /* ========= Scores ========= */
    function getScores(){ return JSON.parse(localStorage.getItem(SCORES_KEY) || '{"p1":0,"p2":0}'); }
    function saveScores(s){ localStorage.setItem(SCORES_KEY, JSON.stringify(s)); updateScorebar(); }
    function getScoreLog(){ return JSON.parse(localStorage.getItem(SCORELOG_KEY) || '{}'); }
    function saveScoreLog(log){ localStorage.setItem(SCORELOG_KEY, JSON.stringify(log)); }

    function updateScorebar(){
      const s=getScores();
      document.getElementById('sb-p1-score').textContent = s.p1;
      document.getElementById('sb-p2-score').textContent = s.p2;
    }

    function resetScores(){
      saveScores({p1:0,p2:0});
      saveScoreLog({});
    }
    function fullReset(){
      if (!confirm("Are you sure you want to reset ALL progress, code, and notes? This cannot be undone.")) return;

      // Keep player names
      const names = getNames();

      // Remove progress, code, notes, and scores
      localStorage.removeItem(PROGRESS_KEY);
      localStorage.removeItem(CODE_KEY);
      localStorage.removeItem(NOTES_KEY);
      resetScores(); // clears score and log

      // Reapply names and refresh UI
      saveNames(names);
      setupSidebar();
      buildHome();
      updateProgress();
      updateScorebar();
      goHome();

      alert("Everything has been reset! 💥");
}


    /* ========= Code & Notes persistence (per lang & slot) ========= */
    function getCodeStore(){ return JSON.parse(localStorage.getItem(CODE_KEY)||'{}'); }
    function saveCodeStore(store){ localStorage.setItem(CODE_KEY, JSON.stringify(store)); }
    // slot: 'solo' | 'p1' | 'p2' | 'collab'
    function loadCode(id, lang, slot){
      const store=getCodeStore();
      const existing = store?.[id]?.[lang]?.[slot];
      if(existing!=null) return existing;
      return templates[lang] || '';
    }
    function saveCode(id, lang, slot, code){
      const store=getCodeStore();
      store[id] = store[id] || {};
      store[id][lang] = store[id][lang] || {};
      store[id][lang][slot] = code;
      saveCodeStore(store);
    }

    function saveNotes(id, text){
      const store=JSON.parse(localStorage.getItem(NOTES_KEY)||'{}');
      store[id]=text;
      localStorage.setItem(NOTES_KEY, JSON.stringify(store));
    }
    function loadNotes(id){
      const store=JSON.parse(localStorage.getItem(NOTES_KEY)||'{}');
      return store[id] ?? '';
    }

    /* ========= Pyodide (Python runner) ========= */
    let pyReadyPromise = null;

    async function ensurePyodide(){
      if(!pyReadyPromise){
        pyReadyPromise = (async () => {
          if(typeof loadPyodide !== 'function'){
            await new Promise((resolve, reject) => {
              const script = document.createElement('script');
              script.src = 'https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js';
              script.onload = resolve;
              script.onerror = () => reject(new Error('Failed to download the Python runtime.'));
              document.head.appendChild(script);
            });
          }
          return loadPyodide({ indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.25.1/full/' });
        })().catch(err => {
          pyReadyPromise = null;
          throw err;
        });
      }
      return pyReadyPromise;
    }

    async function runPython(code, outEl){
      if(!pyReadyPromise){
        outEl.textContent = 'Booting Python runtime… (first load can take a few seconds)';
      }else{
        outEl.textContent = 'Running...';
      }
      try{
        const py = await ensurePyodide();
        const wrapped =
`import sys, io
_buffer = io.StringIO()
_sysout = sys.stdout
sys.stdout = _buffer
# ----- USER CODE START -----
${code}
# ----- USER CODE END -----
try:
    if 'solution' in globals():
        r = solution()
        if r is not None:
            print(r)
finally:
    sys.stdout = _sysout
_result = _buffer.getvalue()`;
        await py.runPythonAsync(wrapped);
        const output = py.runPython('_result');
        outEl.textContent = output || '✔ Ran (no output)';
      }catch(err){
        outEl.textContent = '❌ Error: ' + (err?.message || String(err));
      }
    }

    /* ========= Panel Renderer ========= */
    let currentMode = 'solo'; // 'solo' | 'versus' | 'collab'
    let currentLang = 'python';

    function setMode(mode){ currentMode = mode; loadFromHash(); }
    function setLanguage(lang){ currentLang = lang; loadFromHash(); }

    function buildModeBar(){
      return `
        <div class="mode-bar">
          <button class="mode-button ${currentMode==='solo'?'active':''}" onclick="setMode('solo')"><span class="material-icons" style="font-size:18px;vertical-align:middle">person</span> Solo</button>
          <button class="mode-button ${currentMode==='versus'?'active':''}" onclick="setMode('versus')"><span class="material-icons" style="font-size:18px;vertical-align:middle">sports_kabaddi</span> Versus</button>
          <button class="mode-button ${currentMode==='collab'?'active':''}" onclick="setMode('collab')"><span class="material-icons" style="font-size:18px;vertical-align:middle">handshake</span> Collaborative</button>
        </div>
      `;
    }

    function buildLanguagePicker(available){
      if(!available.includes(currentLang)) currentLang = available[0] || 'python';
      return `
        <div class="language-selector">
          <span class="material-icons">terminal</span>
          <strong>Language:</strong>
          <select class="language-select" onchange="setLanguage(this.value)">
            ${available.map(l=>`<option value="${l}" ${l===currentLang?'selected':''}>${l.toUpperCase()}</option>`).join('')}
          </select>
          <span class="note">Runner supports Python only.</span>
        </div>
      `;
    }

    function setupTabs(activeName){
      const tabs = document.querySelectorAll('.tab');
      const leftDesc = document.getElementById('desc-panel');
      const leftNotes = document.getElementById('notes-panel');

      tabs.forEach(t=>{
        t.onclick = ()=>{
          tabs.forEach(x=>x.classList.remove('active'));
          t.classList.add('active');
          const name = t.textContent.trim();
          if(name==='Description'){
            leftDesc.style.display='block';
            leftNotes.style.display='none';
          }else if(name==='Notes'){
            leftDesc.style.display='none';
            leftNotes.style.display='block';
          }else{
            leftDesc.style.display='none';
            leftNotes.style.display='none';
          }
        };
      });

      const toActivate = Array.from(tabs).find(x=>x.textContent.trim()===activeName) || tabs[0];
      toActivate.click();
    }

    function loadFromHash(){
      const id = location.hash.slice(1);
      const ch = challenges.find(c=>c.id===id);
      const panel = document.getElementById('challenge-panel');
      const home = document.getElementById('home-page');

      highlightActive(id);

      if(!ch){ panel.style.display='none'; home.style.display='block'; return; }
      home.style.display='none';
      panel.style.display='block';

      const progress = JSON.parse(localStorage.getItem(PROGRESS_KEY)||'{}');
      const completed = !!progress[id]?.completed;
      const notes = loadNotes(id);

      panel.innerHTML = `
        <div class="problem-header">
          <h2>${ch.title}</h2>
          <div class="header-actions">
            <div id="completed-badge-wrap">${completed ? '<span class="completed-badge"><span class="material-icons" style="font-size:18px;">check_circle</span> Completed</span>' : ''}</div>
            <button class="run-button" onclick="goHome()">← Back</button>
          </div>
        </div>

        ${buildModeBar()}

        <div class="tabs">
          <button class="tab active">Description</button>
          <button class="tab">Code</button>
          <button class="tab">Notes</button>
        </div>

        <div class="workspace">
          <!-- LEFT -->
          <div class="panel" id="left-panel">
            <div id="desc-panel">
              ${buildLanguagePicker(ch.languages)}
              <p>${ch.description}</p>
              <div class="example-section">
                <h4>Example</h4>
                <pre>${ch.example}</pre>
              </div>
            </div>
            <div id="notes-panel" style="display:none;">
              <textarea id="notes-editor" placeholder="Notes, hints, ideas…">${notes}</textarea>
            </div>
          </div>

          <!-- RIGHT -->
          <div class="panel" id="right-panel">
            ${currentMode==='versus' ? `
              <div class="versus-grid">
                <div>
                  <div class="mini-label"><span class="material-icons">person</span> ${getNames().p1}</div>
                  <textarea id="code-p1">${loadCode(id, currentLang, 'p1')}</textarea>
                  <div class="button-row">
                    <button class="run-button" onclick="onRun('${id}','${currentLang}','p1')">Run</button>
                    <button class="submit-button" onclick="toggleCompletedFor('${id}','p1')" id="complete-toggle-p1">${completed?'Mark Incomplete':'Mark Completed'}</button>
                    <div class="autosave-indicator" id="autosave-ind-p1">Autosaving…</div>
                  </div>
                </div>
                <div>
                  <div class="mini-label"><span class="material-icons">person</span> ${getNames().p2}</div>
                  <textarea id="code-p2">${loadCode(id, currentLang, 'p2')}</textarea>
                  <div class="button-row">
                    <button class="run-button" onclick="onRun('${id}','${currentLang}','p2')">Run</button>
                    <button class="submit-button" onclick="toggleCompletedFor('${id}','p2')" id="complete-toggle-p2">${completed?'Mark Incomplete':'Mark Completed'}</button>
                    <div class="autosave-indicator" id="autosave-ind-p2">Autosaving…</div>
                  </div>
                </div>
              </div>
              <div id="run-output"></div>
            ` : currentMode==='collab' ? `
              <textarea id="code-collab">${loadCode(id, currentLang, 'collab')}</textarea>
              <div class="button-row">
                <button class="run-button" onclick="onRun('${id}','${currentLang}','collab')">Run</button>
                <button class="submit-button" onclick="toggleCompletedFor('${id}','both')" id="complete-toggle">${completed?'Mark Incomplete':'Mark Completed'}</button>
                <div class="autosave-indicator" id="autosave-ind">Autosaving…</div>
              </div>
              <div id="run-output"></div>
            ` : `
              <textarea id="code-solo">${loadCode(id, currentLang, 'solo')}</textarea>
              <div class="button-row">
                <button class="run-button" onclick="onRun('${id}','${currentLang}','solo')">Run</button>
                <button class="submit-button" onclick="toggleCompletedFor('${id}','solo')" id="complete-toggle">${completed?'Mark Incomplete':'Mark Completed'}</button>
                <div class="autosave-indicator" id="autosave-ind">Autosaving…</div>
              </div>
              <div id="run-output"></div>
            `}
          </div>
        </div>
      `;

      // Autosave hookups
      if(currentMode==='versus'){
        hookAutosave('code-p1', id, currentLang, 'p1', 'autosave-ind-p1');
        hookAutosave('code-p2', id, currentLang, 'p2', 'autosave-ind-p2');
      }else if(currentMode==='collab'){
        hookAutosave('code-collab', id, currentLang, 'collab', 'autosave-ind');
      }else{
        hookAutosave('code-solo', id, currentLang, 'solo', 'autosave-ind');
      }

      const notesTA = document.getElementById('notes-editor');
      if(notesTA){
        let t; notesTA.oninput = ()=>{ clearTimeout(t); t=setTimeout(()=> saveNotes(id, notesTA.value), 700); };
      }

      setupTabs('Description');
    }

    function hookAutosave(textareaId, id, lang, slot, indId){
      const ta = document.getElementById(textareaId);
      const ind = document.getElementById(indId);
      let t;
      const setSaved = ()=>{
        if(ind){ ind.textContent='Autosaved'; setTimeout(()=>{ if(ind) ind.textContent='Autosaving…'; }, 1500); }
      };
      ta.oninput = ()=>{
        clearTimeout(t);
        t = setTimeout(()=>{ saveCode(id, lang, slot, ta.value); setSaved(); }, 700);
      };
    }

    async function onRun(id, lang, slot){
      const out = document.getElementById('run-output');
      const codeText =
        slot==='p1' ? document.getElementById('code-p1').value :
        slot==='p2' ? document.getElementById('code-p2').value :
        slot==='collab' ? document.getElementById('code-collab').value :
        document.getElementById('code-solo').value;

      // Save before run
      saveCode(id, lang, slot, codeText);

      if(lang !== 'python'){
        out.textContent = 'ℹ️ Runner supports Python only. Your C code is saved locally.';
        return;
      }
      await runPython(codeText, out);
    }

    function goHome(){
      document.getElementById('challenge-panel').style.display='none';
      document.getElementById('home-page').style.display='block';
      location.hash='';
      highlightActive('');
    }
    function showHomePage() {
      document.getElementById('home-page').style.display = 'block';
      document.getElementById('challenges-page').style.display = 'none';
      document.getElementById('challenge-panel').style.display = 'none';
      highlightActive('');
      location.hash = '';
    }

    function showChallengesPage() {
      document.getElementById('home-page').style.display = 'none';
      document.getElementById('challenges-page').style.display = 'block';
      document.getElementById('challenge-panel').style.display = 'none';
      buildHome(); // rebuild the challenges grid
    }

    /* ========= Complete + Scoring ========= */
    // who: 'p1' | 'p2' | 'both' | 'solo'
    function toggleCompletedFor(id, who){
      const progress = JSON.parse(localStorage.getItem(PROGRESS_KEY)||'{}');
      const log = getScoreLog();
      const wasCompleted = !!progress[id]?.completed;

      if(wasCompleted){
        // Mark incomplete
        delete progress[id];
        localStorage.setItem(PROGRESS_KEY, JSON.stringify(progress));
        // If we had logged a scoring for this challenge, reverse it
        if(log[id]){
          const scores = getScores();
          if(log[id]==='p1'){ scores.p1 = Math.max(0, scores.p1 - 1); }
          else if(log[id]==='p2'){ scores.p2 = Math.max(0, scores.p2 - 1); }
          else if(log[id]==='both'){ scores.p1 = Math.max(0, scores.p1 - 1); scores.p2 = Math.max(0, scores.p2 - 1); }
          // 'solo' gives no score, nothing to reverse
          saveScores(scores);
          delete log[id];
          saveScoreLog(log);
        }
      } else {
        // Mark completed
        progress[id] = { completed:true, completedAt:new Date().toISOString() };
        localStorage.setItem(PROGRESS_KEY, JSON.stringify(progress));

        // Score only if not solo
        if(who==='p1' || who==='p2' || who==='both'){
          const scores = getScores();
          if(who==='p1') scores.p1 += 1;
          else if(who==='p2') scores.p2 += 1;
          else if(who==='both'){ scores.p1 += 1; scores.p2 += 1; }
          saveScores(scores);
          log[id] = who;
          saveScoreLog(log);
        } else {
          // who === 'solo' -> no scoring, but still mark as completed
          log[id] = 'solo';
          saveScoreLog(log);
        }
          // Celebration popup
        const names = getNames();
        const p1 = names.p1.toLowerCase();
        const p2 = names.p2.toLowerCase();
        let message = "yaayyyy";

        if (who === "p1" || who === "both") {
          if (p1.startsWith("paul")) {
            message = "yaaayyyy you did it! you're so smart and nice and pretty! just the best at everything <3";
          } else if (p1.startsWith("ruben")) {
            message = "wow congrats, you're really a nerd (still love you I guess <3)";
          }
        } 
        else if (who === "p2") {
          if (p2.startsWith("paul")) {
            message = "yaaayyyy you did it! you're so smart and nice and pretty! just the best at everything <3";
          } else if (p2.startsWith("ruben")) {
            message = "wow congrats, you're really a nerd (still love you I guess <3)";
          }
        }

        showCelebration(message);

      }

      // UI refresh
      setupSidebar();
      updateProgress();
      updateScorebar();
      // Update header badge + buttons if panel is open
      const badgeWrap = document.getElementById('completed-badge-wrap');
      if(badgeWrap){
        const nowCompleted = !!progress[id]?.completed;
        badgeWrap.innerHTML = nowCompleted ? '<span class="completed-badge"><span class="material-icons" style="font-size:18px;">check_circle</span> Completed</span>' : '';
        // update any toggle buttons labels present
        const p1btn = document.getElementById('complete-toggle-p1');
        const p2btn = document.getElementById('complete-toggle-p2');
        const soloBtn = document.getElementById('complete-toggle');
        if(p1btn) p1btn.textContent = nowCompleted ? 'Mark Incomplete' : 'Mark Completed';
        if(p2btn) p2btn.textContent = nowCompleted ? 'Mark Incomplete' : 'Mark Completed';
        if(soloBtn) soloBtn.textContent = nowCompleted ? 'Mark Incomplete' : 'Mark Completed';
      }
    }
    /* ========= Celebration Popup ========= */
    function showCelebration(message) {
      const overlay = document.getElementById("celebration-overlay");
      overlay.innerHTML = `
        <div class="celebration-popup">
          ${message}
          <div class="hearts">
            <span>💖</span><span>💗</span><span>💞</span><span>💓</span><span>❤️</span>
          </div>
        </div>
      `;
      overlay.style.display = "flex";

      // Hide after animation ends (about 3.5s)
      setTimeout(() => overlay.style.display = "none", 3500);
    }

    /* ========= Init ========= */
    function init(){
      // Names & scores
      updateNamesUI();
      updateScorebar();
      document.getElementById('reset-scores-btn').onclick = resetScores;
      document.getElementById('reset-all-btn').onclick = fullReset;


      // Sidebar & home
      setupSidebar();
      buildHome();
      updateProgress();

      if(location.hash){ loadFromHash(); }
      window.onhashchange = loadFromHash;
    }

    window.onload = init;

    /* === Smooth back-and-forth scroll + drag control === */
    const collage = document.querySelector('.infinite-collage');
    const track = document.querySelector('.scroll-strip');

    if (collage && track) {
      const PLACEHOLDER_SRC = 'data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';
      track.style.visibility = 'hidden';

      const baseCountAttr = track.dataset.loopBaseCount;
      const existingChildren = Array.from(track.children);
      const baseCount = baseCountAttr ? parseInt(baseCountAttr, 10) || 0 : existingChildren.length;
      const originalItems = existingChildren.slice(0, baseCount);

      if (!baseCountAttr) {
        track.dataset.loopBaseCount = String(baseCount);
      }

      if (!track.dataset.loopInitialized && originalItems.length > 0) {
        const cloneForLoop = source => {
          const clone = source.cloneNode(true);
          clone.dataset.loaded = 'false';
          if (!clone.dataset.src && clone.src && !clone.src.startsWith('data:image')) {
            clone.dataset.src = clone.src;
            clone.src = PLACEHOLDER_SRC;
            clone.loading = 'lazy';
            clone.removeAttribute('fetchpriority');
          }
          return clone;
        };

        const beforeFragment = document.createDocumentFragment();
        const afterFragment = document.createDocumentFragment();
        originalItems.forEach(img => {
          beforeFragment.appendChild(cloneForLoop(img));
        });
        originalItems.forEach(img => {
          afterFragment.appendChild(cloneForLoop(img));
        });

        track.insertBefore(beforeFragment, track.firstChild);
        track.appendChild(afterFragment);
        track.dataset.loopInitialized = 'true';
      }

      const totalSets = originalItems.length > 0
        ? Math.max(1, Math.round(track.children.length / originalItems.length))
        : 1;

      let offset = 0;
      let virtualOffset = 0;
      let loopWidth = 0;
      let hasOverflow = false;
      let firstItemWidth = 0;
      let cachedGap = null;
      let targetProgress = 0;
      const scrollSpeed = 2;    // pixels per frame
      const pauseTargetIndex = 4; // zero-based index of image to center on pause

      let isHovering = false;
      let isDragging = false;
      let isManualPause = false;
      let manualPauseTimer;
      let startX = 0;
      let startY = 0;
      let startOffset = 0;
      let isLoopAligned = false;
      let isTrackVisible = false;

      const wrapVirtual = value => {
        if (!hasOverflow || loopWidth <= 0) {
          return 0;
        }
        const min = -loopWidth * (totalSets - 1);
        let next = value;
        while (next < min) {
          next += loopWidth;
          if (isDragging) {
            startOffset += loopWidth;
          }
        }
        while (next > 0) {
          next -= loopWidth;
          if (isDragging) {
            startOffset -= loopWidth;
          }
        }
        return next;
      };

      const applyOffset = value => {
        if (!hasOverflow || loopWidth <= 0) {
          virtualOffset = 0;
          offset = 0;
          track.style.transform = 'translateX(0)';
          return;
        }
        virtualOffset = wrapVirtual(value);
        offset = virtualOffset;
        track.style.transform = `translateX(${offset}px)`;
      };

      const measureFirstItemWidth = () => {
        const first = originalItems[0];
        if (!first) return 0;
        const measured = first.offsetWidth;
        if (measured > 0) {
          if (cachedGap === null) {
            const style = window.getComputedStyle(track);
            cachedGap = parseFloat(style.columnGap || style.gap || '0') || 0;
          }
          firstItemWidth = measured + cachedGap;
        }
        return firstItemWidth;
      };

      const computeTargetProgress = () => {
        const base = originalItems[0];
        let target = originalItems[pauseTargetIndex];
        if (!base) {
          targetProgress = 0;
          return;
        }
        if (!target) {
          target = originalItems[originalItems.length - 1];
        }
        if (!target) {
          targetProgress = 0;
          return;
        }
        const baseLeft = base.offsetLeft;
        const targetLeft = target.offsetLeft - baseLeft;
        const targetWidth = target.getBoundingClientRect().width || firstItemWidth;
        const centerOffset = collage.clientWidth / 2 - targetWidth / 2;
        const raw = targetLeft - centerOffset;
        if (loopWidth > 0) {
          targetProgress = ((raw % loopWidth) + loopWidth) % loopWidth;
        } else {
          targetProgress = 0;
        }
      };

      const updateBounds = () => {
        const totalWidth = track.scrollWidth;
        const viewWidth = collage.clientWidth;
        loopWidth = totalSets > 0 ? totalWidth / totalSets : totalWidth;
        hasOverflow = loopWidth > viewWidth;
        cachedGap = null;
        firstItemWidth = 0;
        measureFirstItemWidth();
        if (loopWidth > 0) {
          computeTargetProgress();
        } else {
          targetProgress = 0;
        }
        if (!hasOverflow) {
          isLoopAligned = false;
          virtualOffset = 0;
          offset = 0;
          track.style.transform = 'translateX(0)';
          if (!isTrackVisible && loopWidth > 0) {
            track.style.visibility = 'visible';
            isTrackVisible = true;
          }
          return;
        }
        if (!isLoopAligned && loopWidth > 0) {
          virtualOffset = -loopWidth;
          isLoopAligned = true;
        }
        applyOffset(virtualOffset);
        if (!isTrackVisible) {
          track.style.visibility = 'visible';
          isTrackVisible = true;
        }
      };

      const temporarilyPauseAuto = (delay = 1800) => {
        isManualPause = true;
        clearTimeout(manualPauseTimer);
        manualPauseTimer = setTimeout(() => {
          isManualPause = false;
        }, delay);
      };

      const shouldAutoScroll = () => hasOverflow && !isHovering && !isDragging && !isManualPause;

      const step = () => {
        if (shouldAutoScroll()) {
          const firstWidth = firstItemWidth > 0 ? firstItemWidth : measureFirstItemWidth();
          if (loopWidth > 0 && firstWidth > 0) {
            const progressed = ((-virtualOffset) % loopWidth + loopWidth) % loopWidth;
            const distanceToTarget = ((targetProgress - progressed) % loopWidth + loopWidth) % loopWidth;
            const slowZone = firstWidth * 0.9;
            let speed = scrollSpeed;
            if (distanceToTarget < loopWidth) {
              if (distanceToTarget < slowZone) {
                const ratio = Math.max(Math.pow(distanceToTarget / slowZone, 0.7), 0.8);
                speed = scrollSpeed * ratio;
              }
              speed = Math.min(speed, Math.max(distanceToTarget, 0.2));
              applyOffset(virtualOffset - speed);
            } else {
              applyOffset(virtualOffset - scrollSpeed);
            }
          } else {
            applyOffset(virtualOffset - scrollSpeed);
          }
        }
        requestAnimationFrame(step);
      };

      const beginDrag = (x, y = null) => {
        if (!hasOverflow) return;
        isDragging = true;
        collage.classList.add('active');
        startX = x;
        startY = y ?? 0;
        startOffset = virtualOffset;
        temporarilyPauseAuto(2000);
      };

      const moveDrag = (x, y = null) => {
        if (!isDragging || !hasOverflow) return;
        if (y !== null && Math.abs(y - startY) > Math.abs(x - startX)) {
          // User is scrolling vertically — end drag so page scroll feels natural.
          endDrag();
          return;
        }
        applyOffset(startOffset + (x - startX));
      };

      const endDrag = () => {
        if (!isDragging) return;
        isDragging = false;
        collage.classList.remove('active');
        temporarilyPauseAuto(1500);
      };

      collage.addEventListener('mouseenter', () => {
        isHovering = true;
      });

      collage.addEventListener('mouseleave', () => {
        isHovering = false;
      });

      collage.addEventListener('mousedown', e => {
        e.preventDefault();
        beginDrag(e.clientX);
      });

      document.addEventListener('mousemove', e => {
        if (!isDragging) return;
        e.preventDefault();
        moveDrag(e.clientX);
      });

      document.addEventListener('mouseup', () => {
        endDrag();
      });

      collage.addEventListener('touchstart', e => {
        const touch = e.touches[0];
        beginDrag(touch.clientX, touch.clientY);
      }, { passive: true });

      collage.addEventListener('touchmove', e => {
        const touch = e.touches[0];
        moveDrag(touch.clientX, touch.clientY);
        if (isDragging) {
          e.preventDefault();
        }
      }, { passive: false });

      collage.addEventListener('touchend', () => {
        endDrag();
      });

      collage.addEventListener('touchcancel', () => {
        endDrag();
      });

      collage.addEventListener('wheel', e => {
        const primaryDelta = Math.abs(e.deltaX) > Math.abs(e.deltaY)
          ? e.deltaX
          : (e.shiftKey ? e.deltaY : 0);

        if (primaryDelta !== 0 && hasOverflow) {
          e.preventDefault();
          temporarilyPauseAuto();
          applyOffset(virtualOffset - primaryDelta);
        }
      }, { passive: false });

      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(updateBounds, 150);
      });

      const collageImages = Array.from(track.querySelectorAll('img'));

      const markAsLoaded = img => {
        img.dataset.loaded = 'true';
        updateBounds();
      };

      const watchUntilLoaded = img => {
        if (img.complete && img.naturalWidth > 1) {
          markAsLoaded(img);
        } else {
          img.addEventListener('load', () => markAsLoaded(img), { once: true });
        }
      };

      const hydrateImage = img => {
        if (img.dataset.src && img.src !== img.dataset.src) {
          img.src = img.dataset.src;
        }
      };

      if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver(entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              observer.unobserve(entry.target);
              hydrateImage(entry.target);
            }
          });
        }, { root: collage, rootMargin: '160px' });

        collageImages.forEach(img => {
          if (img.dataset.src) {
            observer.observe(img);
          }
          watchUntilLoaded(img);
        });
      } else {
        collageImages.forEach(img => {
          hydrateImage(img);
          watchUntilLoaded(img);
        });
      }

      updateBounds();
      requestAnimationFrame(step);
    }

  </script>
  <!-- Celebration Popup -->
<div id="celebration-overlay"></div>
</body>
</html>
